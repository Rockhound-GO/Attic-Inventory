<div class="flex items-center p-4 bg-white rounded-lg border border-stone-200 hover:shadow-md hover:border-amber-400 transition-all duration-200 space-x-4 dark:bg-stone-800 dark:border-stone-700 dark:hover:border-amber-500 dark:ring-offset-stone-900"
     [class.ring-2]="isSelected()"
     [class.ring-offset-2]="isSelected()"
     [class.ring-amber-500]="isSelected()"
     [class.border-amber-400]="isSelected()"
     [class.dark:border-amber-500]="isSelected()">
  <div class="flex-shrink-0">
    <input type="checkbox"
           class="h-5 w-5 rounded border-stone-300 text-amber-600 focus:ring-amber-500 dark:bg-stone-900 dark:border-stone-600"
           [checked]="isSelected()"
           (change)="toggleSelection()"
           (click)="$event.stopPropagation()"
           title="Select this item"
           aria-label="Select item">
  </div>
  <div class="flex-shrink-0">
    <img [src]="item().photo" [alt]="item().name" class="w-24 h-24 md:w-32 md:h-32 object-cover rounded-md bg-stone-200 dark:bg-stone-700">
  </div>
  <div class="flex-grow">
    <div class="flex justify-between items-start">
      <div>
        <div class="flex items-center gap-x-2">
           <span class="inline-block bg-amber-100 text-amber-800 text-xs font-semibold px-2.5 py-0.5 rounded-full dark:bg-amber-500/10 dark:text-amber-300">{{ item().type }}</span>
           @if(item().value > 0) {
            <span class="inline-block bg-green-100 text-green-800 text-xs font-semibold px-2.5 py-0.5 rounded-full dark:bg-green-500/10 dark:text-green-300">${{ item().value }}</span>
           }
        </div>
        <h3 class="text-lg font-bold text-stone-900 dark:text-stone-100 mt-1">{{ item().name }}</h3>
      </div>
      <button (click)="onRemoveClick()" title="Remove this item" class="flex-shrink-0 text-stone-400 hover:text-red-600 transition-colors p-1 rounded-full hover:bg-red-100 dark:text-stone-500 dark:hover:text-red-400 dark:hover:bg-red-900/50">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
      </button>
    </div>
    
    @if(item().history) {
      <p class="text-sm text-stone-600 dark:text-stone-400 mt-2">{{ item().history }}</p>
    }
    
    <div class="mt-3 flex items-center justify-between">
       <div class="relative">
          <select 
            [ngModel]="item().status"
            (ngModelChange)="onStatusChange($event)"
            title="Change item status"
            [class]="'appearance-none text-xs font-medium rounded-md py-1 pl-2 pr-7 border-0 ring-1 ring-inset focus:ring-2 focus:ring-amber-500 transition hover:ring-2 ' + statusColor()">
            @for(status of statuses; track status) {
              <option class="font-medium bg-white dark:bg-stone-800 dark:text-stone-200" [value]="status">{{status}}</option>
            }
          </select>
          <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2">
             <svg class="h-4 w-4 text-stone-400 dark:text-stone-500" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                <path fill-rule="evenodd" d="M10 3a.75.75 0 01.55.24l3.25 3.5a.75.75 0 11-1.1 1.02L10 4.852 7.3 7.76a.75.75 0 01-1.1-1.02l3.25-3.5A.75.75 0 0110 3zm-3.76 9.24a.75.75 0 011.06 0L10 15.148l2.7-2.908a.75.75 0 111.06 1.06l-3.25 3.5a.75.75 0 01-1.06 0l-3.25-3.5a.75.75 0 010-1.06z" clip-rule="evenodd" />
             </svg>
          </div>
       </div>
       <p class="text-xs text-stone-400 dark:text-stone-500">Added: {{ item().createdAt.toLocaleDateString() }}</p>
    </div>

  </div>
</div>

@if (showConfirmation()) {
  <app-confirmation-dialog
    title="Delete Item"
    [message]="'Are you sure you want to permanently delete \'' + item().name + '\'? This action cannot be undone.'"
    confirmText="Delete"
    (confirm)="handleConfirmDelete()"
    (cancel)="handleCancelDelete()">
  </app-confirmation-dialog>
}